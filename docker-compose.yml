services:
  tts-bot:
    build: .
    container_name: tts-bot
    privileged: true
    network_mode: host
    pid: host
    env_file:
      - .env
    environment:
      - BOT_TOKEN=${BOT_TOKEN}
      - BOT_NAME=${BOT_NAME:-kiro-bot}
      - TMUX_SESSION=${TMUX_SESSION:-kiro_master}
      - DATA_DIR=/data
      - API_PORT=${API_PORT:-15001}
      - REDIS_URL=redis://localhost:6379/0
      - TMUX_SOCKET=/tmp/tmux-1001/default
      - OWNER_ID=${OWNER_ID:-0}
      - GEMINI_API_KEY=${GEMINI_API_KEY:-}
    volumes:
      - ./data:/data
      - /tmp/tmux-1001:/tmp/tmux-1001
      - /home/w3c_offical/.kiro:/home/w3c_offical/.kiro:ro
      - /home/w3c_offical/personal:/home/w3c_offical/personal
      - ./tts_bot:/app/tts_bot
      - ./scripts:/app/scripts
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:15001/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
